<!DOCTYPE html>
<html>

<head>
      <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v -->



<meta name="generator" content="Jekyll v4.3.2" />





<meta property="og:locale" content="" />

  <link rel="shortcut icon" type="image/png" href="/webdataconnector/assets/logo.png">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/webdataconnector/assets/css/main.css">
  <link rel="stylesheet" href="/webdataconnector/assets/css/github-highlight.css">

  <script src="/webdataconnector/assets/js/redirect-to-search.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>



</head>

<body>
    <div class="container">
        <header class="site-header">
  <div class="wrapper">
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand navbar-brand-logo" href="/webdataconnector/#">Tableau Web Data Connector</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/webdataconnector/docs/index.html">Docs</a></li>
            <li><a href="/webdataconnector/docs/api_ref.html">API Reference</a></li>
            <li><a href="/webdataconnector/community/">Community Connectors</a></li>
            <li><a target="_blank" href="https://community.tableau.com/s/topic/0TO4T000000QFBJWA4/web-data-connector">Forum</a></li>
            <li><a href="/webdataconnector/news/">What's New?</a></li>
            
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="tableauIcon"><a target="_blank" href="http://tableau.com"><img src="/webdataconnector/assets/logo.png" alt="Tableau Developers" class="logo" /></a></li>
            <li><a target="_blank" href="https://github.com/tableau/webdataconnector"><span class="icon icon--github" title="WDC on GitHub" alt="WDC on GitHub"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
  </div>
</header>

        <div class="well docs-menu col-xs-12 col-sm-4 col-md-3">
    <div class="search-container form-group has-feedback">
    <form id="docs-search">
        <input type="search" id="search-input" class="custom-search form-control" placeholder="Search the docs..." search-url="/webdataconnector/docs/search.html">
        <span class="glyphicon glyphicon-search form-control-feedback"></span>
    </form>
</div>


    <ul class="nav nav-list">
        <li class="nav-header">Overview</li>
        <li>
            <a href="/webdataconnector/docs/index.html">Get Started</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_tutorial.html">Tutorial</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_use_in_tableau.html">Use a WDC in Tableau Desktop</a>
        </li>
		<li>
            <a href="/webdataconnector/docs/wdc_use_in_server.html">Use a WDC in Tableau Server</a>
        </li>

        <li class="nav-header">Basic Concepts</li>
        <li>
            <a href="/webdataconnector/docs/wdc_phases.html">Lifecycle and Phases</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_library_versions.html">API Versions</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_samples.html">Samples</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_debugging.html">Debugging in the Simulator and Tableau</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_hosting_and_submissions.html">Hosting and Submitting to Community Portal</a>
        </li>

        <li class="nav-header">Advanced Concepts</li>
        <li>
            <a href="/webdataconnector/docs/wdc_multi_table_tutorial.html">Multiple Tables Tutorial</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_oauth_tutorial.html">Node.js Proxy with OAuth Tutorial</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_standard_connections.html">Standard Connections</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_join_filtering.html">Join Filtering</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_custom_init_and_shutdown.html">Custom Initialization and Shutdown</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_get_data.html">Get Data: Best Practices</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_incremental_refresh.html">Incremental Refresh</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_authentication.html">Authentication</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_cors.html">Working with CORS</a>
        </li>

        <li class="nav-header">Reference</li>
        <li>
            <a href="/webdataconnector/docs/wdc_resources.html">Resources</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_ref_date_formats.html">Supported Date Formats</a>
        </li>
        <li>
            <a href="/webdataconnector/docs/wdc_faq.html">FAQ</a>
        </li>
		    <li>
		    <a href="/webdataconnector/docs/wdc_upgrade.html">Upgrading from WDC Version 1.x</a>
        </li>
        <li>
		    <a href="/webdataconnector/docs/wdc_webengine.html">Troubleshoot WDC WebEngine Issues</a>
		   </li>
           <li>
		    <a href="/webdataconnector/docs/wdc_about.html">About Tableau Help</a>
		   </li>
    </ul>
</div>


        <div class="content .col-xs-12 .col-sm-8 .col-md-9">
            <h1>WDC Multiple Tables Tutorial</h1>
            <div class="alert alert-info"><p><strong>Important</strong>: Tableau Web Data Connector 2.0 (this version) is being deprecated at Tableau 2023.1 and eventually retired. We will still support WDC 2.0 until its last compatible version of Tableau (Tableau 2022.4) goes End of Life and is no longer supported.</p>

            <p>For information about Tableau Web Data Connector 3.0, see the <a href="https://help.tableau.com/current/api/webdataconnector/en-us/index.html">WDC 3.0 documentation</a>.</p>
            </div>
            <div class="edit-container">
                <a href="https://github.com/tableau/webdataconnector/edit/master/docs/wdc_multi_table_tutorial.md" class="edit-links"><span class="glyphicon glyphicon-pencil"></span> Edit this page</a>
                &nbsp;
                <a href="https://github.com/tableau/webdataconnector/issues" class="edit-links"><span class="glyphicon glyphicon-flag"></span> Submit an issue</a>
            </div>
            <br />
            <blockquote>
  <p>This tutorial builds on the connector created in the basic <a href="/webdataconnector/docs/wdc_tutorial">tutorial</a>. Ensure
that you understand the concepts in the basic tutorial before you continue.</p>
</blockquote>

<p>By the end of this tutorial, you will know how to store data in multiple tables and pass user input to your connector.</p>

<p>You’ll learn how to:</p>

<ul id="markdown-toc">
  <li><a href="#before-you-get-started" id="markdown-toc-before-you-get-started">Before you get started</a></li>
  <li><a href="#create-the-user-interface" id="markdown-toc-create-the-user-interface">Create the user interface</a></li>
  <li><a href="#store-connection-data" id="markdown-toc-store-connection-data">Store connection data</a></li>
  <li><a href="#get-multiple-table-schemas" id="markdown-toc-get-multiple-table-schemas">Get Multiple Table Schemas</a></li>
  <li><a href="#get-data-for-each-table" id="markdown-toc-get-data-for-each-table">Get data for each table</a></li>
  <li><a href="#see-in-action" id="markdown-toc-see-in-action">See it in action</a></li>
</ul>

<p>To see the source code for the completed connector, look for the <code class="language-plaintext highlighter-rouge">earthquakeMultitable</code> files in the <code class="language-plaintext highlighter-rouge">Examples</code> directory.</p>

<h3 id="before-you-get-started">Before you get started</h3>

<p>This tutorial builds on the USGS Earthquake feed connector created in the <a href="/webdataconnector/docs/wdc_tutorial">tutorial</a>. Before you get started, you’ll need to make a copy of the connector that you can edit.</p>

<ol>
  <li>
    <p>Copy the <code class="language-plaintext highlighter-rouge">earthquakeUSGS</code> files from the <code class="language-plaintext highlighter-rouge">Examples</code> directory and the <code class="language-plaintext highlighter-rouge">js</code> directory to the top-level directory for
the repository. (This is the same directory as the README.)</p>
  </li>
  <li>
    <p>Rename the files to <code class="language-plaintext highlighter-rouge">earthquakeMultitable.html</code> and <code class="language-plaintext highlighter-rouge">earthquakeMultitable.js</code>.</p>
  </li>
  <li>
    <p>Edit the <code class="language-plaintext highlighter-rouge">earthquakeMultitable.html</code> file to point to the renamed <code class="language-plaintext highlighter-rouge">earthquakeMultitable.js</code> file:</p>

    <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"earthquakeMultitable.js"</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre></div>    </div>
  </li>
</ol>

<h3 id="create-the-user-interface">Create the user interface</h3>

<p>The existing connector interface doesn’t do very much–it’s just a button that you can click to run the connector. To
illustrate how to pass user input data to your connector, let’s add a form so that you can specify the date range for
which you want to get earthquake data.</p>

<p>Open the <code class="language-plaintext highlighter-rouge">earthquakeMultitable.html</code> file, and copy the following code immediately above the <code class="language-plaintext highlighter-rouge">&lt;button&gt;</code> element:</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;h2&gt;</span>Get Earthquake Data for a Time Range<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;form&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-inline"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"start-date-one"</span> <span class="na">class=</span><span class="s">"text-center"</span><span class="nt">&gt;</span>Start Date<span class="nt">&lt;/label&gt;</span>
		<span class="nt">&lt;span&gt;</span><span class="ni">&amp;mdash;</span><span class="nt">&lt;span&gt;</span>
		<span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"end-date-one"</span><span class="nt">&gt;</span>End Date<span class="nt">&lt;/label&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
	<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-inline"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"start-date-one"</span> <span class="na">value=</span><span class="s">"2016-05-08"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">id=</span><span class="s">"end-date-one"</span> <span class="na">value=</span><span class="s">"2016-05-15"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre></div></div>

<p>This is a simple form with a label and text fields where you can enter date values. Additionally, there are some <code class="language-plaintext highlighter-rouge">&lt;div&gt;</code>
elements and classes on each element to use Bootstrap styling. If you load the page in a browser, the result looks like
this:</p>

<p><img src="/webdataconnector/assets/earthquake_multitable_ui.png" alt="&quot;The connector interface displays four input fields with labels for date ranges.&quot;" /></p>

<h3 id="store-connection-data">Store connection data</h3>

<p>Now that you’ve updated the user interface, it’s time to consume the user input data in the JavaScript code. We’re going
to get the values from the input fields and store them in a <code class="language-plaintext highlighter-rouge">tableau.connectionData</code> variable for use later.</p>

<p>Open the <code class="language-plaintext highlighter-rouge">earthquakeMultitable.js</code> file, and replace the <code class="language-plaintext highlighter-rouge">$(document).ready</code> function with the following code :</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nf">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#submitButton</span><span class="dl">"</span><span class="p">).</span><span class="nf">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">dateObj</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">startDate</span><span class="p">:</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#start-date-one</span><span class="dl">'</span><span class="p">).</span><span class="nf">val</span><span class="p">().</span><span class="nf">trim</span><span class="p">(),</span>
            <span class="na">endDate</span><span class="p">:</span> <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#end-date-one</span><span class="dl">'</span><span class="p">).</span><span class="nf">val</span><span class="p">().</span><span class="nf">trim</span><span class="p">(),</span>
        <span class="p">};</span>

        <span class="kd">function</span> <span class="nf">isValidDate</span><span class="p">(</span><span class="nx">dateStr</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">dateStr</span><span class="p">);</span>
            <span class="k">return</span> <span class="o">!</span><span class="nf">isNaN</span><span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nf">getDate</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="nf">if </span><span class="p">(</span><span class="nf">isValidDate</span><span class="p">(</span><span class="nx">dateObj</span><span class="p">.</span><span class="nx">startDate</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nf">isValidDate</span><span class="p">(</span><span class="nx">dateObj</span><span class="p">.</span><span class="nx">endDate</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">tableau</span><span class="p">.</span><span class="nx">connectionData</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">dateObj</span><span class="p">);</span>
            <span class="nx">tableau</span><span class="p">.</span><span class="nx">connectionName</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">USGS Earthquake Feed</span><span class="dl">"</span><span class="p">;</span>
            <span class="nx">tableau</span><span class="p">.</span><span class="nf">submit</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#errorMsg</span><span class="dl">'</span><span class="p">).</span><span class="nf">html</span><span class="p">(</span><span class="dl">"</span><span class="s2">Enter valid dates. For example, 2016-05-08.</span><span class="dl">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Some things to note about the code:</p>

<ul>
  <li>As with the connector in the basic tutorial, the connector uses jquery to run code when the page loads and creates an
event listener for the submit button.</li>
  <li>The values of the date input fields are stored in a date object. (The jquery <code class="language-plaintext highlighter-rouge">val()</code> function gets the value of a
field, and the <code class="language-plaintext highlighter-rouge">trim()</code> function removes spaces.)</li>
  <li>The <code class="language-plaintext highlighter-rouge">isValidDate</code> function takes a string value and determines whether the string is a valid date.</li>
  <li>The <code class="language-plaintext highlighter-rouge">if</code> statement does some simple form validation using the <code class="language-plaintext highlighter-rouge">isValidDate</code> function.
    <ul>
      <li>If the dates are valid, the date object is converted to a string.</li>
      <li>If the dates are not valid, an error message is displayed in the <code class="language-plaintext highlighter-rouge">div</code> with the <code class="language-plaintext highlighter-rouge">errorMsg</code> id.</li>
    </ul>
  </li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">tableau.connectionData</code> variable is the important piece here. It is created by the WDC so that you can pass data to
the <code class="language-plaintext highlighter-rouge">getSchema</code> and <code class="language-plaintext highlighter-rouge">getData</code> functions. It is important to note that the <code class="language-plaintext highlighter-rouge">tableau.connectionData</code> variable only accepts
string values.</p>

<h3 id="get-multiple-table-schemas">Get Multiple Table Schemas</h3>

<p>In this part of the tutorial, you modify the <code class="language-plaintext highlighter-rouge">getSchema</code> code to create two table schemas and pass them to the
<code class="language-plaintext highlighter-rouge">schemaCallback</code> in an array parameter.</p>

<p>Replace the <code class="language-plaintext highlighter-rouge">myConnector.getSchema</code> function with the following code:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myConnector</span><span class="p">.</span><span class="nx">getSchema</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">schemaCallback</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// Schema for magnitude and place data</span>
	<span class="kd">var</span> <span class="nx">mag_place_cols</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">mag</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">magnitude</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">float</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lat</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">latitude</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">columnRole</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dimension</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">float</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">lon</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">longitude</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">columnRole</span><span class="p">:</span> <span class="dl">"</span><span class="s2">dimension</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">float</span>
	<span class="p">}];</span>

	<span class="kd">var</span> <span class="nx">magPlaceTable</span> <span class="o">=</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">magPlace</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Magnitude and Place Data</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">columns</span><span class="p">:</span> <span class="nx">mag_place_cols</span>
	<span class="p">};</span>

	<span class="c1">// Schema for time and URL data</span>
	<span class="kd">var</span> <span class="nx">time_url_cols</span> <span class="o">=</span> <span class="p">[{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">time</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">time</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">date</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">dataType</span><span class="p">:</span> <span class="nx">tableau</span><span class="p">.</span><span class="nx">dataTypeEnum</span><span class="p">.</span><span class="nx">string</span>
	<span class="p">}];</span>

	<span class="kd">var</span> <span class="nx">timeUrlTable</span> <span class="o">=</span> <span class="p">{</span>
		<span class="na">id</span><span class="p">:</span> <span class="dl">"</span><span class="s2">timeUrl</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">alias</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Time and URL Data</span><span class="dl">"</span><span class="p">,</span>
		<span class="na">columns</span><span class="p">:</span> <span class="nx">time_url_cols</span>
	<span class="p">};</span>
	<span class="nf">schemaCallback</span><span class="p">([</span><span class="nx">magPlaceTable</span><span class="p">,</span> <span class="nx">timeUrlTable</span><span class="p">]);</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Here’s what’s happening in the code:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">mag_place_cols</code> and <code class="language-plaintext highlighter-rouge">time_url_cols</code> arrays contain objects for the columns in our tables.</li>
  <li>The <code class="language-plaintext highlighter-rouge">magPlaceTable</code> and <code class="language-plaintext highlighter-rouge">timeUrlTable</code> variables each define a table schema object.</li>
  <li>The table schemas are passed to <code class="language-plaintext highlighter-rouge">schemaCallback</code> as objects in an array.</li>
</ul>

<h3 id="get-data-for-each-table">Get data for each table</h3>

<p>When you create multiple table schemas, the WDC API calls the <code class="language-plaintext highlighter-rouge">getData</code> function once for each schema. As a result, you
need a way to change the call to the USGS Earthquake API for each table. The easiest way to do this is to use the
<code class="language-plaintext highlighter-rouge">table.tableInfo.id</code> value that we set in the table schemas.</p>

<p>Replace the <code class="language-plaintext highlighter-rouge">myConnector.getData</code> function with the following code:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">myConnector</span><span class="p">.</span><span class="nx">getData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">table</span><span class="p">,</span> <span class="nx">doneCallback</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">dateObj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">tableau</span><span class="p">.</span><span class="nx">connectionData</span><span class="p">),</span>
		<span class="nx">dateString</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">starttime=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">dateObj</span><span class="p">.</span><span class="nx">startDate</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&amp;endtime=</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">dateObj</span><span class="p">.</span><span class="nx">endDate</span><span class="p">,</span>
		<span class="nx">apiCall</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&amp;</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">dateString</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">&amp;minmagnitude=4.5</span><span class="dl">"</span><span class="p">;</span>

	<span class="nx">$</span><span class="p">.</span><span class="nf">getJSON</span><span class="p">(</span><span class="nx">apiCall</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">resp</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">feat</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">features</span><span class="p">,</span>
			<span class="nx">tableData</span> <span class="o">=</span> <span class="p">[];</span>

		<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="nf">if </span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">tableInfo</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">magPlace</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
			<span class="nf">for </span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">tableData</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
					<span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">mag</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">mag</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">title</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">lon</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					<span class="dl">"</span><span class="s2">lat</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="nf">if </span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">tableInfo</span><span class="p">.</span><span class="nx">id</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">timeUrl</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
			<span class="nf">for </span><span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">feat</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">tableData</span><span class="p">.</span><span class="nf">push</span><span class="p">({</span>
					<span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">url</span><span class="dl">"</span><span class="p">:</span> <span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span>
					<span class="dl">"</span><span class="s2">time</span><span class="dl">"</span><span class="p">:</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">(</span><span class="nx">feat</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">properties</span><span class="p">.</span><span class="nx">time</span><span class="p">)</span> <span class="c1">// Convert to a date format from epoch time</span>
				<span class="p">});</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="nx">table</span><span class="p">.</span><span class="nf">appendRows</span><span class="p">(</span><span class="nx">tableData</span><span class="p">);</span>
		<span class="nf">doneCallback</span><span class="p">();</span>
	<span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>

<p>Let’s take a look at what’s going on here:</p>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">JSON.parse</code> function converts the string value that we stored in the <code class="language-plaintext highlighter-rouge">tableau.connectionData</code> variable back to an
object. The <code class="language-plaintext highlighter-rouge">dateObj</code> object can then be used to access the data that we stored.</li>
  <li>The <code class="language-plaintext highlighter-rouge">dateString</code> variable inserts the start and end dates into a query parameter format expected by the API.</li>
  <li>The <code class="language-plaintext highlighter-rouge">apiCall</code> variable is the URL for our API call. Note that this is a different URL than we used in the basic
tutorial. For more information on the query parameters that you can use with this URL, see the <a href="http://earthquake.usgs.gov/fdsnws/event/1/">Earthquake Catalog API
Documentation</a>.</li>
  <li>We declare the <code class="language-plaintext highlighter-rouge">for</code> loop iterator variable <code class="language-plaintext highlighter-rouge">i</code> at the top of the function to avoid declaring it twice.</li>
  <li>We use the <code class="language-plaintext highlighter-rouge">table.tableInfo.id</code> to determine which table schema we should use as we push data to the <code class="language-plaintext highlighter-rouge">tableData</code>
array. Remember that the WDC API makes one call to <code class="language-plaintext highlighter-rouge">getData</code> for each table schema.</li>
  <li>The <code class="language-plaintext highlighter-rouge">table.appendRows</code> function adds the array of table data to the table object.</li>
</ul>

<h3 id="see-in-action">See it in action</h3>

<p>That’s it for the coding part of this tutorial. Time to test your connector in the simulator like you did in the <a href="/webdataconnector/docs/">Get
Started</a> section and the basic tutorial.</p>

<p>When you’re done, try to <a href="http://tableau.github.io/webdataconnector/docs/wdc_use_in_tableau">open your connector in
Tableau</a>. Once you open your connector in Tableau,
you can drag the <strong>Magnitude and Place Data</strong> table and the <strong>Time and URL Data</strong> table to the pane where it says <strong>Drag
tables here</strong>. You can ensure that the tables are joined properly on the <code class="language-plaintext highlighter-rouge">id</code> field by clicking the overlapping circles
to display the join information.</p>

<p><img src="/webdataconnector/assets/wdc_tableau_multitable_join.png" alt="&quot;Join multiple connector tables in Tableau.&quot;" /></p>

<p>Want to check your work? See the source code in the <code class="language-plaintext highlighter-rouge">Examples</code> directory.</p>

<p>Now you’re <em>definitely</em> ready to make your own connector!</p>

<p>You might also want to
learn about <a href="/webdataconnector/docs/wdc_incremental_refresh">incremental refresh</a> and <a href="/webdataconnector/docs/wdc_authentication">authentication</a>. See the <a href="/webdataconnector/docs/wdc_oauth_tutorial.html">WDC Node.js Proxy with OAuth Tutorial</a>.</p>

            <!-- Footer -->
<footer>
    <div class="row">
            <hr class="footer-hr">
            <p>This site is open source. Suggestions and pull requests are welcome on our <a href="https://github.com/tableau/webdataconnector">GitHub page</a>.</p>
            <p><a href="https://www.tableau.com/en-us/legal" class="aLegal">LEGAL</a> <a href="https://www.salesforce.com/company/privacy/" class="aLegal">PRIVACY</a> &copy; 2003&ndash;<script>document.write(new Date().getFullYear())</script> TABLEAU SOFTWARE LLC. ALL RIGHTS RESERVED</p>
            <sub>Documentation last generated on: 2023-03-07 13:27:13 -0800</sub>
    </div>
</footer>

        </div>
    </div>
</body>

</html>
